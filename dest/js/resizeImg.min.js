"use strict";function _resizeImg(r,e){function a(r,e){var a=document.createElement("canvas"),n=r.width/r.height,o=e.width||r.width,t=e.width?Math.floor(e.width/n):r.height;a.width=o,a.height=t;var i=a.getContext("2d");i.drawImage(r,0,0,o,t);var f=a.toDataURL("image/jpeg",e.quality||.8);return navigator.userAgent.match(/iphone/i)&&(new MegaPixImage(r).render(a,{maxWidth:o,maxHeight:t,quality:e.quality||.8}),f=a.toDataURL("image/jpeg",e.quality||.8)),navigator.userAgent.match(/Android/i)&&(f=(new function(r){function e(r){for(var e=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],a=0;a<64;a++){var n=I((e[a]*r+50)/100);n<1?n=1:n>255&&(n=255),j[N[a]]=n}for(var o=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],t=0;t<64;t++){var i=I((o[t]*r+50)/100);i<1?i=1:i>255&&(i=255),M[N[t]]=i}for(var f=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],c=0,v=0;v<8;v++)for(var u=0;u<8;u++)S[c]=1/(j[N[c]]*f[v]*f[u]*8),U[c]=1/(M[N[c]]*f[v]*f[u]*8),c++}function a(r,e){for(var a=0,n=0,o=new Array,t=1;t<=16;t++){for(var i=1;i<=r[t];i++)o[e[n]]=[],o[e[n]][0]=a,o[e[n]][1]=t,n++,a++;a*=2}return o}function n(){d=a(O,P),A=a(F,G),p=a(Q,W),b=a(J,K)}function o(){for(var r=1,e=2,a=1;a<=15;a++){for(var n=r;n<e;n++)C[32767+n]=a,q[32767+n]=[],q[32767+n][1]=a,q[32767+n][0]=n;for(var o=-(e-1);o<=-r;o++)C[32767+o]=a,q[32767+o]=[],q[32767+o][1]=a,q[32767+o][0]=e-1+o;r<<=1,e<<=1}}function t(){for(var r=0;r<256;r++)H[r]=19595*r,H[r+256>>0]=38470*r,H[r+512>>0]=7471*r+32768,H[r+768>>0]=-11059*r,H[r+1024>>0]=-21709*r,H[r+1280>>0]=32768*r+8421375,H[r+1536>>0]=-27439*r,H[r+1792>>0]=-5329*r}function i(r){for(var e=r[0],a=r[1]-1;a>=0;)e&1<<a&&(E|=1<<L),a--,--L<0&&(255==E?(f(255),f(0)):f(E),L=7,E=0)}function f(r){x.push(B[r])}function c(r){f(r>>8&255),f(255&r)}function v(r,e){var a,n,o,t,i,f,c,v,u,s=0;for(u=0;u<8;++u){a=r[s],n=r[s+1],o=r[s+2],t=r[s+3],i=r[s+4],f=r[s+5],c=r[s+6];var y=a+(v=r[s+7]),g=a-v,h=n+c,l=n-c,w=o+f,m=o-f,d=t+i,A=t-i,p=y+d,b=y-d,D=h+w,I=h-w;r[s]=p+D,r[s+4]=p-D;var j=.707106781*(I+b);r[s+2]=b+j,r[s+6]=b-j;var M=.382683433*((p=A+m)-(I=l+g)),S=.5411961*p+M,U=1.306562965*I+M,q=.707106781*(D=m+l),C=g+q,_=g-q;r[s+5]=_+S,r[s+3]=_-S,r[s+1]=C+U,r[s+7]=C-U,s+=8}for(s=0,u=0;u<8;++u){a=r[s],n=r[s+8],o=r[s+16],t=r[s+24],i=r[s+32],f=r[s+40],c=r[s+48];var x=a+(v=r[s+56]),E=a-v,L=n+c,R=n-c,z=o+f,k=o-f,B=t+i,H=t-i,N=x+B,O=x-B,P=L+z,Q=L-z;r[s]=N+P,r[s+32]=N-P;var W=.707106781*(Q+O);r[s+16]=O+W,r[s+48]=O-W;var F=.382683433*((N=H+k)-(Q=R+E)),G=.5411961*N+F,J=1.306562965*Q+F,K=.707106781*(P=k+R),V=E+K,X=E-K;r[s+40]=X+G,r[s+24]=X-G,r[s+8]=V+J,r[s+56]=V-J,s++}var Y;for(u=0;u<64;++u)Y=r[u]*e[u],T[u]=Y>0?Y+.5|0:Y-.5|0;return T}function u(){c(65504),c(16),f(74),f(70),f(73),f(70),f(0),f(1),f(1),f(0),c(1),c(1),f(0),f(0)}function s(r,e){c(65472),c(17),f(8),c(e),c(r),f(3),f(1),f(17),f(0),f(2),f(17),f(1),f(3),f(17),f(1)}function y(){c(65499),c(132),f(0);for(var r=0;r<64;r++)f(j[r]);f(1);for(var e=0;e<64;e++)f(M[e])}function g(){c(65476),c(418),f(0);for(var r=0;r<16;r++)f(O[r+1]);for(var e=0;e<=11;e++)f(P[e]);f(16);for(var a=0;a<16;a++)f(Q[a+1]);for(var n=0;n<=161;n++)f(W[n]);f(1);for(var o=0;o<16;o++)f(F[o+1]);for(var t=0;t<=11;t++)f(G[t]);f(17);for(var i=0;i<16;i++)f(J[i+1]);for(var v=0;v<=161;v++)f(K[v])}function h(){c(65498),c(12),f(3),f(1),f(0),f(2),f(17),f(3),f(17),f(0),f(63),f(0)}function l(r,e,a,n,o){for(var t,f=o[0],c=o[240],u=v(r,e),s=0;s<64;++s)_[N[s]]=u[s];var y=_[0]-a;a=_[0],0==y?i(n[0]):(i(n[C[t=32767+y]]),i(q[t]));for(var g=63;g>0&&0==_[g];g--);if(0==g)return i(f),a;for(var h,l=1;l<=g;){for(var w=l;0==_[l]&&l<=g;++l);var m=l-w;if(m>=16){h=m>>4;for(var d=1;d<=h;++d)i(c);m&=15}t=32767+_[l],i(o[(m<<4)+C[t]]),i(q[t]),l++}return 63!=g&&i(f),a}function w(){for(var r=String.fromCharCode,e=0;e<256;e++)B[e]=r(e)}function m(r){r<=0&&(r=1),r>100&&(r=100),D!=r&&(e(r<50?Math.floor(5e3/r):Math.floor(200-2*r)),D=r,console.log("Quality set to: "+r+"%"))}Math.round;var d,A,p,b,D,I=Math.floor,j=new Array(64),M=new Array(64),S=new Array(64),U=new Array(64),q=new Array(65535),C=new Array(65535),T=new Array(64),_=new Array(64),x=[],E=0,L=7,R=new Array(64),z=new Array(64),k=new Array(64),B=new Array(256),H=new Array(2048),N=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],O=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],P=[0,1,2,3,4,5,6,7,8,9,10,11],Q=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],W=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],F=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],G=[0,1,2,3,4,5,6,7,8,9,10,11],J=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],K=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];this.encode=function(r,e,a){var n=(new Date).getTime();e&&m(e),x=new Array,E=0,L=7,c(65496),u(),y(),s(r.width,r.height),g(),h();var o=0,t=0,f=0;E=0,L=7,this.encode.displayName="_encode_";for(var v,w,D,I,j,M,q,C,T,_=r.data,B=r.width,N=r.height,O=4*B,P=0;P<N;){for(v=0;v<O;){for(M=j=O*P+v,q=-1,C=0,T=0;T<64;T++)M=j+(C=T>>3)*O+(q=4*(7&T)),P+C>=N&&(M-=O*(P+1+C-N)),v+q>=O&&(M-=v+q-O+4),w=_[M++],D=_[M++],I=_[M++],R[T]=(H[w]+H[D+256>>0]+H[I+512>>0]>>16)-128,z[T]=(H[w+768>>0]+H[D+1024>>0]+H[I+1280>>0]>>16)-128,k[T]=(H[w+1280>>0]+H[D+1536>>0]+H[I+1792>>0]>>16)-128;o=l(R,S,o,d,p),t=l(z,U,t,A,b),f=l(k,U,f,A,b),v+=32}P+=8}if(L>=0){var Q=[];Q[1]=L+1,Q[0]=(1<<L+1)-1,i(Q)}if(c(65497),a){for(var W=x.length,F=new Uint8Array(W),G=0;G<W;G++)F[G]=x[G].charCodeAt();return x=[],K=(new Date).getTime()-n,console.log("Encoding time: "+K+"ms"),F}var J="data:image/jpeg;base64,"+btoa(x.join(""));x=[];var K=(new Date).getTime()-n;return console.log("Encoding time: "+K+"ms"),J},function(){var e=(new Date).getTime();r||(r=50),w(),n(),o(),t(),m(r);var a=(new Date).getTime()-e;console.log("Initialization "+a+"ms")}()}).encode(i.getImageData(0,0,o,t),100*e.quality||80)),e.type?function(r,e){for(var a=atob(r.split(",")[1]),n=[],o=0;o<a.length;o++)n.push(a.charCodeAt(o));return new Blob([new Uint8Array(n)],{type:e})}(f,e.type):f}switch(void 0===r?"undefined":_typeof(r)){case"string":var n=new Image;n.src=r,r&&(n.onload=function(){e.success(a(n,e))});break;case"object":if(r instanceof Array){var o=0;r.forEach(function(n,t){if(!n)return console.error("请传入正确的图片地址，当前图片地址为："+n);var i=new Image;i.src=n,i.onload=function(){r.splice(t,1,a(i,e)),++o==r.length&&e.success(r)}},this)}else{var t=URL.createObjectURL(r);(n=new Image).src=t,r&&(n.onload=function(){e.success(a(n,e))})}}}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r};