/*!
 * resizeImg.js v1.0.0
 * Github: https://github.com/lyswhut/resizeImg
 * 
 * Released under the MIT License.
 * 
 * 图片压缩
 * @param {String|Array|Object} imgs 图片路径字符串/图片路径数组/file对象/Blob对象
 * @param {Object} options
 * @param {Number} [options.width] 图片需要压缩的最大宽度，高度会跟随调整
 * @param {Number} [options.height] 图片需要压缩的最大高度，宽度会跟随调整
 * @param {Number} [options.quality=0.8] 压缩质量，不压缩为1
 * @param {String} [options.type] 可选，需要返回的文件类型，如'image/jpeg'、'image/png'等
 * @param {Function} [options.success(result)] 完成的回调函数，若type有值，则返回blob，否则返回base64
 * @example 接收图片路径压缩
 *   __resizeImg('test.jpg', {
 *     width: 200,
 *     height: 200,
 *     quality: 0.9,
 *     type: 'image/jpeg',
 *     success: function($Blob) {
 *       // formData.append("imgFile", $Blob, "file_" + new Date().getTime() + ".jpg");
 *       // ...
 *     }
 *   })
 * @example 接收file对象压缩
 *   var dom_input_file = document.querySelector('#file_1')
 *   __resizeImg(dom_input_file.files[0], {
 *     width: 200,
 *     height: 200,
 *     quality: 0.9,
 *     type: 'image/jpeg',
 *     success: function($Blob){
 *       // formData.append("imgFile", $Blob, "file_" + new Date().getTime() + ".jpg");
 *       // ...
 *     }
 *   })
 * 
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("__resizeImg",[],t):"object"==typeof exports?exports.__resizeImg=t():e.__resizeImg=t()}(window,(function(){return function(e){var t={};function r(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(a,n,function(t){return e[t]}.bind(null,n));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var n=r(1),o=r(2),i=function(e,t){var r,a,i=document.createElement("canvas");if(t.width&&t.height){var c=e.width/e.height;e.width>t.width?(r=t.width,a=Math.floor(t.width/c)):(r=Math.floor(t.height*c),a=t.height)}else r=e.width,a=e.height;i.width=r,i.height=a;var f=i.getContext("2d");f.drawImage(e,0,0,r,a);var u=i.toDataURL("image/jpeg",t.quality||.8);navigator.userAgent.match(/iphone/i)&&(new o(e).render(i,{maxWidth:r,maxHeight:a,quality:t.quality||.8}),u=i.toDataURL("image/jpeg",t.quality||.8));navigator.userAgent.match(/Android/i)&&(u=(new n).encode(f.getImageData(0,0,r,a),100*t.quality||80));return t.type?function(e,t){for(var r=atob(e.split(",")[1]),a=[],n=0;n<r.length;n++)a.push(r.charCodeAt(n));return new Blob([new Uint8Array(a)],{type:t})}(u,t.type):u};e.exports=function(e,t){switch(a(e)){case"string":var r=new Image;r.src=e,e&&(r.onload=function(){t.success(i(r,t))});break;case"object":if(e instanceof Array){var n=0;e.forEach((function(r,a){if(!r)return console.error("请传入正确的图片地址，当前图片地址为："+r);var o=new Image;o.src=r,o.onload=function(){e.splice(a,1,i(o,t)),++n==e.length&&t.success(e)}}),this)}else{var o=URL.createObjectURL(e);(r=new Image).src=o,e&&(r.onload=function(){t.success(i(r,t))})}}}},function(e,t){e.exports=function(e){Math.round;var t,r,a,n,o,i=Math.floor,c=new Array(64),f=new Array(64),u=new Array(64),s=new Array(64),h=new Array(65535),l=new Array(65535),d=new Array(64),v=new Array(64),g=[],m=0,w=7,y=new Array(64),b=new Array(64),p=new Array(64),I=new Array(256),L=new Array(2048),j=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],A=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],x=[0,1,2,3,4,5,6,7,8,9,10,11],U=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],M=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],R=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],_=[0,1,2,3,4,5,6,7,8,9,10,11],O=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],k=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function D(e,t){for(var r=0,a=0,n=new Array,o=1;o<=16;o++){for(var i=1;i<=e[o];i++)n[t[a]]=[],n[t[a]][0]=r,n[t[a]][1]=o,a++,r++;r*=2}return n}function S(e){for(var t=e[0],r=e[1]-1;r>=0;)t&1<<r&&(m|=1<<w),r--,--w<0&&(255==m?(C(255),C(0)):C(m),w=7,m=0)}function C(e){g.push(I[e])}function P(e){C(e>>8&255),C(255&e)}function E(e,t,r,a,n){for(var o,i=n[0],c=n[240],f=function(e,t){var r,a,n,o,i,c,f,u,s,h,l=0;for(s=0;s<8;++s){r=e[l],a=e[l+1],n=e[l+2],o=e[l+3],i=e[l+4],c=e[l+5],f=e[l+6];var v=r+(u=e[l+7]),g=r-u,m=a+f,w=a-f,y=n+c,b=n-c,p=o+i,I=o-i,L=v+p,j=v-p,A=m+y,x=m-y;e[l]=L+A,e[l+4]=L-A;var U=.707106781*(x+j);e[l+2]=j+U,e[l+6]=j-U;var M=.382683433*((L=I+b)-(x=w+g)),R=.5411961*L+M,_=1.306562965*x+M,O=.707106781*(A=b+w),k=g+O,D=g-O;e[l+5]=D+R,e[l+3]=D-R,e[l+1]=k+_,e[l+7]=k-_,l+=8}for(l=0,s=0;s<8;++s){r=e[l],a=e[l+8],n=e[l+16],o=e[l+24],i=e[l+32],c=e[l+40],f=e[l+48];var S=r+(u=e[l+56]),C=r-u,P=a+f,E=a-f,T=n+c,q=n-c,H=o+i,W=o-i,z=S+H,B=S-H,N=P+T,Q=P-T;e[l]=z+N,e[l+32]=z-N;var F=.707106781*(Q+B);e[l+16]=B+F,e[l+48]=B-F;var G=.382683433*((z=W+q)-(Q=E+C)),J=.5411961*z+G,K=1.306562965*Q+G,V=.707106781*(N=q+E),X=C+V,Y=C-V;e[l+40]=Y+J,e[l+24]=Y-J,e[l+8]=X+K,e[l+56]=X-K,l++}for(s=0;s<64;++s)h=e[s]*t[s],d[s]=h>0?h+.5|0:h-.5|0;return d}(e,t),u=0;u<64;++u)v[j[u]]=f[u];var s=v[0]-r;r=v[0],0==s?S(a[0]):(S(a[l[o=32767+s]]),S(h[o]));for(var g=63;g>0&&0==v[g];g--);if(0==g)return S(i),r;for(var m,w=1;w<=g;){for(var y=w;0==v[w]&&w<=g;++w);var b=w-y;if(b>=16){m=b>>4;for(var p=1;p<=m;++p)S(c);b&=15}o=32767+v[w],S(n[(b<<4)+l[o]]),S(h[o]),w++}return 63!=g&&S(i),r}function T(e){if(e<=0&&(e=1),e>100&&(e=100),o!=e){(function(e){for(var t=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],r=0;r<64;r++){var a=i((t[r]*e+50)/100);a<1?a=1:a>255&&(a=255),c[j[r]]=a}for(var n=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],o=0;o<64;o++){var h=i((n[o]*e+50)/100);h<1?h=1:h>255&&(h=255),f[j[o]]=h}for(var l=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],d=0,v=0;v<8;v++)for(var g=0;g<8;g++)u[d]=1/(c[j[d]]*l[v]*l[g]*8),s[d]=1/(f[j[d]]*l[v]*l[g]*8),d++})(e<50?Math.floor(5e3/e):Math.floor(200-2*e)),o=e,console.log("Quality set to: "+e+"%")}}this.encode=function(e,o,i){var h=(new Date).getTime();o&&T(o),g=new Array,m=0,w=7,P(65496),P(65504),P(16),C(74),C(70),C(73),C(70),C(0),C(1),C(1),C(0),P(1),P(1),C(0),C(0),function(){P(65499),P(132),C(0);for(var e=0;e<64;e++)C(c[e]);C(1);for(var t=0;t<64;t++)C(f[t])}(),function(e,t){P(65472),P(17),C(8),P(t),P(e),C(3),C(1),C(17),C(0),C(2),C(17),C(1),C(3),C(17),C(1)}(e.width,e.height),function(){P(65476),P(418),C(0);for(var e=0;e<16;e++)C(A[e+1]);for(var t=0;t<=11;t++)C(x[t]);C(16);for(var r=0;r<16;r++)C(U[r+1]);for(var a=0;a<=161;a++)C(M[a]);C(1);for(var n=0;n<16;n++)C(R[n+1]);for(var o=0;o<=11;o++)C(_[o]);C(17);for(var i=0;i<16;i++)C(O[i+1]);for(var c=0;c<=161;c++)C(k[c])}(),P(65498),P(12),C(3),C(1),C(0),C(2),C(17),C(3),C(17),C(0),C(63),C(0);var l=0,d=0,v=0;m=0,w=7,this.encode.displayName="_encode_";for(var I,j,D,q,H,W,z,B,N,Q=e.data,F=e.width,G=e.height,J=4*F,K=0;K<G;){for(I=0;I<J;){for(W=H=J*K+I,z=-1,B=0,N=0;N<64;N++)W=H+(B=N>>3)*J+(z=4*(7&N)),K+B>=G&&(W-=J*(K+1+B-G)),I+z>=J&&(W-=I+z-J+4),j=Q[W++],D=Q[W++],q=Q[W++],y[N]=(L[j]+L[D+256>>0]+L[q+512>>0]>>16)-128,b[N]=(L[j+768>>0]+L[D+1024>>0]+L[q+1280>>0]>>16)-128,p[N]=(L[j+1280>>0]+L[D+1536>>0]+L[q+1792>>0]>>16)-128;l=E(y,u,l,t,a),d=E(b,s,d,r,n),v=E(p,s,v,r,n),I+=32}K+=8}if(w>=0){var V=[];V[1]=w+1,V[0]=(1<<w+1)-1,S(V)}if(P(65497),i){for(var X=g.length,Y=new Uint8Array(X),Z=0;Z<X;Z++)Y[Z]=g[Z].charCodeAt();g=[];var $=(new Date).getTime()-h;return console.log("Encoding time: "+$+"ms"),Y}var ee="data:image/jpeg;base64,"+btoa(g.join(""));g=[];$=(new Date).getTime()-h;return console.log("Encoding time: "+$+"ms"),ee},function(){var o=(new Date).getTime();e||(e=50),function(){for(var e=String.fromCharCode,t=0;t<256;t++)I[t]=e(t)}(),t=D(A,x),r=D(R,_),a=D(U,M),n=D(O,k),function(){for(var e=1,t=2,r=1;r<=15;r++){for(var a=e;a<t;a++)l[32767+a]=r,h[32767+a]=[],h[32767+a][1]=r,h[32767+a][0]=a;for(var n=-(t-1);n<=-e;n++)l[32767+n]=r,h[32767+n]=[],h[32767+n][1]=r,h[32767+n][0]=t-1+n;e<<=1,t<<=1}}(),function(){for(var e=0;e<256;e++)L[e]=19595*e,L[e+256>>0]=38470*e,L[e+512>>0]=7471*e+32768,L[e+768>>0]=-11059*e,L[e+1024>>0]=-21709*e,L[e+1280>>0]=32768*e+8421375,L[e+1536>>0]=-27439*e,L[e+1792>>0]=-5329*e}(),T(e);var i=(new Date).getTime()-o;console.log("Initialization "+i+"ms")}()}},function(e,t,r){var a;!function(){function r(e,t,r,a){var n=e.naturalWidth,o=e.naturalHeight;if(n+o){var i=r.width,c=r.height,f=t.getContext("2d");f.save(),function(e,t,r,a,n){switch(n){case 5:case 6:case 7:case 8:e.width=a,e.height=r;break;default:e.width=r,e.height=a}switch(n){case 2:t.translate(r,0),t.scale(-1,1);break;case 3:t.translate(r,a),t.rotate(Math.PI);break;case 4:t.translate(0,a),t.scale(1,-1);break;case 5:t.rotate(.5*Math.PI),t.scale(1,-1);break;case 6:t.rotate(.5*Math.PI),t.translate(0,-a);break;case 7:t.rotate(.5*Math.PI),t.translate(r,-a),t.scale(-1,1);break;case 8:t.rotate(-.5*Math.PI),t.translate(-r,0)}}(t,f,i,c,r.orientation),function(e){var t=e.naturalWidth;if(t*e.naturalHeight>1048576){var r=document.createElement("canvas");r.width=r.height=1;var a=r.getContext("2d");return a.drawImage(e,1-t,0),0===a.getImageData(0,0,1,1).data[3]}return!1}(e)&&(n/=2,o/=2);var u=1024,s=document.createElement("canvas");s.width=s.height=u;for(var h=s.getContext("2d"),l=a?function(e,t,r){var a=document.createElement("canvas");a.width=1,a.height=r;var n=a.getContext("2d");n.drawImage(e,0,0);for(var o=n.getImageData(0,0,1,r).data,i=0,c=r,f=r;f>i;){0===o[4*(f-1)+3]?c=f:i=f,f=c+i>>1}var u=f/r;return 0===u?1:u}(e,0,o):1,d=Math.ceil(u*i/n),v=Math.ceil(u*c/o/l),g=0,m=0;g<o;){for(var w=0,y=0;w<n;)h.clearRect(0,0,u,u),h.drawImage(e,-w,-g),f.drawImage(s,0,0,u,u,y,m,d,v),w+=u,y+=d;g+=u,m+=v}f.restore(),s=h=null}}var n=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;function o(e){if(window.Blob&&e instanceof Blob){if(!n)throw Error("No createObjectURL function found to create blob url");var t=new Image;t.src=n.createObjectURL(e),this.blob=e,e=t}if(!e.naturalWidth&&!e.naturalHeight){var r=this;e.onload=e.onerror=function(){var e=r.imageLoadListeners;if(e){r.imageLoadListeners=null;for(var t=0,a=e.length;t<a;t++)e[t]()}},this.imageLoadListeners=[]}this.srcImage=e}o.prototype.render=function(e,t,a){if(this.imageLoadListeners){var o=this;this.imageLoadListeners.push((function(){o.render(e,t,a)}))}else{t=t||{};var i=this.srcImage.naturalWidth,c=this.srcImage.naturalHeight,f=t.width,u=t.height,s=t.maxWidth,h=t.maxHeight,l=!this.blob||"image/jpeg"===this.blob.type;f&&!u?u=c*f/i<<0:u&&!f?f=i*u/c<<0:(f=i,u=c),s&&f>s&&(u=c*(f=s)/i<<0),h&&u>h&&(f=i*(u=h)/c<<0);var d={width:f,height:u};for(var v in t)d[v]=t[v];var g=e.tagName.toLowerCase();"img"===g?e.src=function(e,t,a){var n=document.createElement("canvas");return r(e,n,t,a),n.toDataURL("image/jpeg",t.quality||.8)}(this.srcImage,d,l):"canvas"===g&&r(this.srcImage,e,d,l),"function"==typeof this.onrender&&this.onrender(e),a&&a(),this.blob&&(this.blob=null,n.revokeObjectURL(this.srcImage.src))}},void 0===(a=function(){return o}.apply(t,[]))||(e.exports=a)}()}])}));