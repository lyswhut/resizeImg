"use strict";/** @preserve
 * resizeImg v1.0.0
 * Github: https://github.com/lyswhut/resizeImg
 * 
 * Released under the MIT License.
 * 
 * 图片压缩
 * @param {String|Array|Object} imgs 图片路径字符串/图片路径数组/file对象
 * @param {Object} options
 * @param {Number} [options.width] 图片需要压缩的宽度，高度会跟随调整
 * @param {Number} [options.quality=0.8] 压缩质量，不压缩为1
 * @param {String} [options.type] 可选，需要返回的文件类型，如'image/jpeg'、'image/png'等
 * @param {Function} [options.success(result)] 完成的回调函数，若type有值，则返回blob，否则返回base64
 * @example 接收图片路径压缩
    __resizeImg('test.jpg', {
      width: 200,
      quality: 0.9,
      type: 'image/jpeg',
      success: function($Blob) {
        formData.append("imgFile", $Blob, "file_" + new Date().getTime() + ".jpg");
        //...
      }
    })
 * @example 接收file对象压缩
    var dom_input_file = document.querySelector('#file_1')
    __resizeImg(dom_input_file.files[0], {
      width: 200,
      quality: 0.9,
      type: 'image/jpeg',
      success: function($Blob){
        formData.append("imgFile", $Blob, "file_" + new Date().getTime() + ".jpg");
        //...
      }
    })
 */
function __resizeImg(e,t){function r(e,t){var r=document.createElement("canvas"),a=e.width/e.height,n=t.width||e.width,o=t.width?Math.floor(t.width/a):e.height;r.width=n,r.height=o;var i=r.getContext("2d");i.drawImage(e,0,0,n,o);var c=r.toDataURL("image/jpeg",t.quality||.8);return navigator.userAgent.match(/iphone/i)&&(new MegaPixImage(e).render(r,{maxWidth:n,maxHeight:o,quality:t.quality||.8}),c=r.toDataURL("image/jpeg",t.quality||.8)),navigator.userAgent.match(/Android/i)&&(c=(new JPEGEncoder).encode(i.getImageData(0,0,n,o),100*t.quality||80)),t.type?function(e,t){for(var r=atob(e.split(",")[1]),a=[],n=0;n<r.length;n++)a.push(r.charCodeAt(n));return new Blob([new Uint8Array(a)],{type:t})}(c,t.type):c}switch(void 0===e?"undefined":_typeof(e)){case"string":var a=new Image;a.src=e,e&&(a.onload=function(){t.success(r(a,t))});break;case"object":if(e instanceof Array){var n=0;e.forEach(function(a,o){if(!a)return console.error("请传入正确的图片地址，当前图片地址为："+a);var i=new Image;i.src=a,i.onload=function(){e.splice(o,1,r(i,t)),++n==e.length&&t.success(e)}},this)}else{var o=URL.createObjectURL(e);(a=new Image).src=o,e&&(a.onload=function(){t.success(r(a,t))})}}}function JPEGEncoder(e){function t(e){for(var t=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],r=0;r<64;r++){var a=A((t[r]*e+50)/100);a<1?a=1:a>255&&(a=255),U[T[r]]=a}for(var n=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],o=0;o<64;o++){var i=A((n[o]*e+50)/100);i<1?i=1:i>255&&(i=255),R[T[o]]=i}for(var c=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],f=0,s=0;s<8;s++)for(var u=0;u<8;u++)j[f]=1/(U[T[f]]*c[s]*c[u]*8),x[f]=1/(R[T[f]]*c[s]*c[u]*8),f++}function r(e,t){for(var r=0,a=0,n=new Array,o=1;o<=16;o++){for(var i=1;i<=e[o];i++)n[t[a]]=[],n[t[a]][0]=r,n[t[a]][1]=o,a++,r++;r*=2}return n}function a(){y=r(B,N),b=r(J,Q),p=r(z,G),I=r(F,K)}function n(){for(var e=1,t=2,r=1;r<=15;r++){for(var a=e;a<t;a++)E[32767+a]=r,M[32767+a]=[],M[32767+a][1]=r,M[32767+a][0]=a;for(var n=-(t-1);n<=-e;n++)E[32767+n]=r,M[32767+n]=[],M[32767+n][1]=r,M[32767+n][0]=t-1+n;e<<=1,t<<=1}}function o(){for(var e=0;e<256;e++)W[e]=19595*e,W[e+256>>0]=38470*e,W[e+512>>0]=7471*e+32768,W[e+768>>0]=-11059*e,W[e+1024>>0]=-21709*e,W[e+1280>>0]=32768*e+8421375,W[e+1536>>0]=-27439*e,W[e+1792>>0]=-5329*e}function i(e){for(var t=e[0],r=e[1]-1;r>=0;)t&1<<r&&(C|=1<<P),r--,--P<0&&(255==C?(c(255),c(0)):c(C),P=7,C=0)}function c(e){S.push(O[e])}function f(e){c(e>>8&255),c(255&e)}function s(e,t){var r,a,n,o,i,c,f,s,u,h=0;for(u=0;u<8;++u){r=e[h],a=e[h+1],n=e[h+2],o=e[h+3],i=e[h+4],c=e[h+5],f=e[h+6];var l=r+(s=e[h+7]),d=r-s,v=a+f,g=a-f,m=n+c,w=n-c,y=o+i,b=o-i,p=l+y,I=l-y,L=v+m,A=v-m;e[h]=p+L,e[h+4]=p-L;var U=.707106781*(A+I);e[h+2]=I+U,e[h+6]=I-U;var R=.382683433*((p=b+w)-(A=g+d)),j=.5411961*p+R,x=1.306562965*A+R,M=.707106781*(L=w+g),E=d+M,D=d-M;e[h+5]=D+j,e[h+3]=D-j,e[h+1]=E+x,e[h+7]=E-x,h+=8}for(h=0,u=0;u<8;++u){r=e[h],a=e[h+8],n=e[h+16],o=e[h+24],i=e[h+32],c=e[h+40],f=e[h+48];var S=r+(s=e[h+56]),C=r-s,P=a+f,_=a-f,q=n+c,H=n-c,O=o+i,W=o-i,T=S+O,B=S-O,N=P+q,z=P-q;e[h]=T+N,e[h+32]=T-N;var G=.707106781*(z+B);e[h+16]=B+G,e[h+48]=B-G;var J=.382683433*((T=W+H)-(z=_+C)),Q=.5411961*T+J,F=1.306562965*z+J,K=.707106781*(N=H+_),V=C+K,X=C-K;e[h+40]=X+Q,e[h+24]=X-Q,e[h+8]=V+F,e[h+56]=V-F,h++}var Y;for(u=0;u<64;++u)Y=e[u]*t[u],k[u]=Y>0?Y+.5|0:Y-.5|0;return k}function u(){f(65504),f(16),c(74),c(70),c(73),c(70),c(0),c(1),c(1),c(0),f(1),f(1),c(0),c(0)}function h(e,t){f(65472),f(17),c(8),f(t),f(e),c(3),c(1),c(17),c(0),c(2),c(17),c(1),c(3),c(17),c(1)}function l(){f(65499),f(132),c(0);for(var e=0;e<64;e++)c(U[e]);c(1);for(var t=0;t<64;t++)c(R[t])}function d(){f(65476),f(418),c(0);for(var e=0;e<16;e++)c(B[e+1]);for(var t=0;t<=11;t++)c(N[t]);c(16);for(var r=0;r<16;r++)c(z[r+1]);for(var a=0;a<=161;a++)c(G[a]);c(1);for(var n=0;n<16;n++)c(J[n+1]);for(var o=0;o<=11;o++)c(Q[o]);c(17);for(var i=0;i<16;i++)c(F[i+1]);for(var s=0;s<=161;s++)c(K[s])}function v(){f(65498),f(12),c(3),c(1),c(0),c(2),c(17),c(3),c(17),c(0),c(63),c(0)}function g(e,t,r,a,n){for(var o,c=n[0],f=n[240],u=s(e,t),h=0;h<64;++h)D[T[h]]=u[h];var l=D[0]-r;r=D[0],0==l?i(a[0]):(i(a[E[o=32767+l]]),i(M[o]));for(var d=63;d>0&&0==D[d];d--);if(0==d)return i(c),r;for(var v,g=1;g<=d;){for(var m=g;0==D[g]&&g<=d;++g);var w=g-m;if(w>=16){v=w>>4;for(var y=1;y<=v;++y)i(f);w&=15}o=32767+D[g],i(n[(w<<4)+E[o]]),i(M[o]),g++}return 63!=d&&i(c),r}function m(){for(var e=String.fromCharCode,t=0;t<256;t++)O[t]=e(t)}function w(e){if(e<=0&&(e=1),e>100&&(e=100),L!=e){t(e<50?Math.floor(5e3/e):Math.floor(200-2*e)),L=e,console.log("Quality set to: "+e+"%")}}Math.round;var y,b,p,I,L,A=Math.floor,U=new Array(64),R=new Array(64),j=new Array(64),x=new Array(64),M=new Array(65535),E=new Array(65535),k=new Array(64),D=new Array(64),S=[],C=0,P=7,_=new Array(64),q=new Array(64),H=new Array(64),O=new Array(256),W=new Array(2048),T=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],B=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],N=[0,1,2,3,4,5,6,7,8,9,10,11],z=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],G=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],J=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],Q=[0,1,2,3,4,5,6,7,8,9,10,11],F=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],K=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];this.encode=function(e,t,r){var a=(new Date).getTime();t&&w(t),S=new Array,C=0,P=7,f(65496),u(),l(),h(e.width,e.height),d(),v();var n=0,o=0,c=0;C=0,P=7,this.encode.displayName="_encode_";for(var s,m,L,A,U,R,M,E,k,D=e.data,O=e.width,T=e.height,B=4*O,N=0;N<T;){for(s=0;s<B;){for(R=U=B*N+s,M=-1,E=0,k=0;k<64;k++)R=U+(E=k>>3)*B+(M=4*(7&k)),N+E>=T&&(R-=B*(N+1+E-T)),s+M>=B&&(R-=s+M-B+4),m=D[R++],L=D[R++],A=D[R++],_[k]=(W[m]+W[L+256>>0]+W[A+512>>0]>>16)-128,q[k]=(W[m+768>>0]+W[L+1024>>0]+W[A+1280>>0]>>16)-128,H[k]=(W[m+1280>>0]+W[L+1536>>0]+W[A+1792>>0]>>16)-128;n=g(_,j,n,y,p),o=g(q,x,o,b,I),c=g(H,x,c,b,I),s+=32}N+=8}if(P>=0){var z=[];z[1]=P+1,z[0]=(1<<P+1)-1,i(z)}if(f(65497),r){for(var G=S.length,J=new Uint8Array(G),Q=0;Q<G;Q++)J[Q]=S[Q].charCodeAt();S=[];K=(new Date).getTime()-a;return console.log("Encoding time: "+K+"ms"),J}var F="data:image/jpeg;base64,"+btoa(S.join(""));S=[];var K=(new Date).getTime()-a;return console.log("Encoding time: "+K+"ms"),F},function(){var t=(new Date).getTime();e||(e=50),m(),a(),n(),o(),w(e);var r=(new Date).getTime()-t;console.log("Initialization "+r+"ms")}()}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){function e(e){var t=e.naturalWidth;if(t*e.naturalHeight>1048576){var r=document.createElement("canvas");r.width=r.height=1;var a=r.getContext("2d");return a.drawImage(e,1-t,0),0===a.getImageData(0,0,1,1).data[3]}return!1}function t(e,t,r){var a=document.createElement("canvas");a.width=1,a.height=r;var n=a.getContext("2d");n.drawImage(e,0,0);for(var o=n.getImageData(0,0,1,r).data,i=0,c=r,f=r;f>i;)0===o[4*(f-1)+3]?c=f:i=f,f=c+i>>1;var s=f/r;return 0===s?1:s}function r(e,t,r){var n=document.createElement("canvas");return a(e,n,t,r),n.toDataURL("image/jpeg",t.quality||.8)}function a(r,a,o,i){var c=r.naturalWidth,f=r.naturalHeight;if(c+f){var s=o.width,u=o.height,h=a.getContext("2d");h.save(),n(a,h,s,u,o.orientation),e(r)&&(c/=2,f/=2);var l=1024,d=document.createElement("canvas");d.width=d.height=l;for(var v=d.getContext("2d"),g=i?t(r,c,f):1,m=Math.ceil(l*s/c),w=Math.ceil(l*u/f/g),y=0,b=0;y<f;){for(var p=0,I=0;p<c;)v.clearRect(0,0,l,l),v.drawImage(r,-p,-y),h.drawImage(d,0,0,l,l,I,b,m,w),p+=l,I+=m;y+=l,b+=w}h.restore(),d=v=null}}function n(e,t,r,a,n){switch(n){case 5:case 6:case 7:case 8:e.width=a,e.height=r;break;default:e.width=r,e.height=a}switch(n){case 2:t.translate(r,0),t.scale(-1,1);break;case 3:t.translate(r,a),t.rotate(Math.PI);break;case 4:t.translate(0,a),t.scale(1,-1);break;case 5:t.rotate(.5*Math.PI),t.scale(1,-1);break;case 6:t.rotate(.5*Math.PI),t.translate(0,-a);break;case 7:t.rotate(.5*Math.PI),t.translate(r,-a),t.scale(-1,1);break;case 8:t.rotate(-.5*Math.PI),t.translate(-r,0)}}function o(e){if(window.Blob&&e instanceof Blob){if(!i)throw Error("No createObjectURL function found to create blob url");var t=new Image;t.src=i.createObjectURL(e),this.blob=e,e=t}if(!e.naturalWidth&&!e.naturalHeight){var r=this;e.onload=e.onerror=function(){var e=r.imageLoadListeners;if(e){r.imageLoadListeners=null;for(var t=0,a=e.length;t<a;t++)e[t]()}},this.imageLoadListeners=[]}this.srcImage=e}var i=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;o.prototype.render=function(e,t,n){if(this.imageLoadListeners){var o=this;this.imageLoadListeners.push(function(){o.render(e,t,n)})}else{t=t||{};var c=this.srcImage.naturalWidth,f=this.srcImage.naturalHeight,s=t.width,u=t.height,h=t.maxWidth,l=t.maxHeight,d=!this.blob||"image/jpeg"===this.blob.type;s&&!u?u=f*s/c<<0:u&&!s?s=c*u/f<<0:(s=c,u=f),h&&s>h&&(u=f*(s=h)/c<<0),l&&u>l&&(s=c*(u=l)/f<<0);var v={width:s,height:u};for(var g in t)v[g]=t[g];var m=e.tagName.toLowerCase();"img"===m?e.src=r(this.srcImage,v,d):"canvas"===m&&a(this.srcImage,e,v,d),"function"==typeof this.onrender&&this.onrender(e),n&&n(),this.blob&&(this.blob=null,i.revokeObjectURL(this.srcImage.src))}},"function"==typeof define&&define.amd?define([],function(){return o}):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=o:window.MegaPixImage=o}();