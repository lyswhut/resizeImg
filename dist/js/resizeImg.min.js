"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};
/** @preserve
 * resizeImg v1.0.0
 * Github: https://github.com/lyswhut/resizeImg
 * 
 * Released under the MIT License.
 * 
 * 图片压缩
 * @param {String|Array|Object} imgs 图片路径字符串/图片路径数组/file对象/Blob对象
 * @param {Object} options
 * @param {Number} [options.width] 图片需要压缩的宽度，高度会跟随调整
 * @param {Number} [options.quality=0.8] 压缩质量，不压缩为1
 * @param {String} [options.type] 可选，需要返回的文件类型，如'image/jpeg'、'image/png'等
 * @param {Function} [options.success(result)] 完成的回调函数，若type有值，则返回blob，否则返回base64
 * @example 接收图片路径压缩
    __resizeImg('test.jpg', {
      width: 200,
      quality: 0.9,
      type: 'image/jpeg',
      success: function($Blob) {
        // formData.append("imgFile", $Blob, "file_" + new Date().getTime() + ".jpg");
        // ...
      }
    })
 * @example 接收file对象压缩
    var dom_input_file = document.querySelector('#file_1')
    __resizeImg(dom_input_file.files[0], {
      width: 200,
      quality: 0.9,
      type: 'image/jpeg',
      success: function($Blob){
        // formData.append("imgFile", $Blob, "file_" + new Date().getTime() + ".jpg");
        // ...
      }
    })
 */function __resizeImg(a,n){switch(void 0===a?"undefined":_typeof(a)){case"string":var e=new Image;(e.src=a)&&(e.onload=function(){n.success(i(e,n))});break;case"object":if(a instanceof Array){var o=0;a.forEach(function(e,t){if(!e)return console.error("请传入正确的图片地址，当前图片地址为："+e);var r=new Image;r.src=e,r.onload=function(){a.splice(t,1,i(r,n)),++o==a.length&&n.success(a)}},this)}else{var t=URL.createObjectURL(a);(e=new Image).src=t,a&&(e.onload=function(){n.success(i(e,n))})}}function i(e,t){var r=document.createElement("canvas"),a=e.width/e.height,n=t.width||e.width,o=t.width?Math.floor(t.width/a):e.height;r.width=n,r.height=o;var i=r.getContext("2d");i.drawImage(e,0,0,n,o);var c=r.toDataURL("image/jpeg",t.quality||.8);navigator.userAgent.match(/iphone/i)&&(new MegaPixImage(e).render(r,{maxWidth:n,maxHeight:o,quality:t.quality||.8}),c=r.toDataURL("image/jpeg",t.quality||.8));navigator.userAgent.match(/Android/i)&&(c=(new JPEGEncoder).encode(i.getImageData(0,0,n,o),100*t.quality||80));return t.type?function(e,t){for(var r=atob(e.split(",")[1]),a=[],n=0;n<r.length;n++)a.push(r.charCodeAt(n));return new Blob([new Uint8Array(a)],{type:t})}(c,t.type):c}}function JPEGEncoder(r){Math.round;var x,M,E,k,t,h=Math.floor,D=new Array(64),S=new Array(64),C=new Array(64),P=new Array(64),w=new Array(65535),y=new Array(65535),Y=new Array(64),b=new Array(64),_=[],q=0,H=7,O=new Array(64),W=new Array(64),T=new Array(64),a=new Array(256),B=new Array(2048),p=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],N=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],z=[0,1,2,3,4,5,6,7,8,9,10,11],G=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],J=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],Q=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],F=[0,1,2,3,4,5,6,7,8,9,10,11],K=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],V=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function n(e,t){for(var r=0,a=0,n=new Array,o=1;o<=16;o++){for(var i=1;i<=e[o];i++)n[t[a]]=[],n[t[a]][0]=r,n[t[a]][1]=o,a++,r++;r*=2}return n}function X(e){for(var t=e[0],r=e[1]-1;0<=r;)t&1<<r&&(q|=1<<H),r--,--H<0&&(255==q?(Z(255),Z(0)):Z(q),H=7,q=0)}function Z(e){_.push(a[e])}function $(e){Z(e>>8&255),Z(255&e)}function ee(e,t,r,a,n){for(var o,i=n[0],c=n[240],f=function(e,t){var r,a,n,o,i,c,f,s,u,h,l=0;for(u=0;u<8;++u){r=e[l],a=e[l+1],n=e[l+2],o=e[l+3],i=e[l+4],c=e[l+5],f=e[l+6];var d=r+(s=e[l+7]),v=r-s,g=a+f,m=a-f,w=n+c,y=n-c,b=o+i,p=o-i,I=d+b,L=d-b,A=g+w,U=g-w;e[l]=I+A,e[l+4]=I-A;var R=.707106781*(U+L);e[l+2]=L+R,e[l+6]=L-R;var j=.382683433*((I=p+y)-(U=m+v)),x=.5411961*I+j,M=1.306562965*U+j,E=.707106781*(A=y+m),k=v+E,D=v-E;e[l+5]=D+x,e[l+3]=D-x,e[l+1]=k+M,e[l+7]=k-M,l+=8}for(u=l=0;u<8;++u){r=e[l],a=e[l+8],n=e[l+16],o=e[l+24],i=e[l+32],c=e[l+40],f=e[l+48];var S=r+(s=e[l+56]),C=r-s,P=a+f,_=a-f,q=n+c,H=n-c,O=o+i,W=o-i,T=S+O,B=S-O,N=P+q,z=P-q;e[l]=T+N,e[l+32]=T-N;var G=.707106781*(z+B);e[l+16]=B+G,e[l+48]=B-G;var J=.382683433*((T=W+H)-(z=_+C)),Q=.5411961*T+J,F=1.306562965*z+J,K=.707106781*(N=H+_),V=C+K,X=C-K;e[l+40]=X+Q,e[l+24]=X-Q,e[l+8]=V+F,e[l+56]=V-F,l++}for(u=0;u<64;++u)h=e[u]*t[u],Y[u]=0<h?.5+h|0:h-.5|0;return Y}(e,t),s=0;s<64;++s)b[p[s]]=f[s];var u=b[0]-r;r=b[0],0==u?X(a[0]):(X(a[y[o=32767+u]]),X(w[o]));for(var h=63;0<h&&0==b[h];h--);if(0==h)return X(i),r;for(var l,d=1;d<=h;){for(var v=d;0==b[d]&&d<=h;++d);var g=d-v;if(16<=g){l=g>>4;for(var m=1;m<=l;++m)X(c);g&=15}o=32767+b[d],X(n[(g<<4)+y[o]]),X(w[o]),d++}return 63!=h&&X(i),r}function te(e){if(e<=0&&(e=1),100<e&&(e=100),t!=e){(function(e){for(var t=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],r=0;r<64;r++){var a=h((t[r]*e+50)/100);a<1?a=1:255<a&&(a=255),D[p[r]]=a}for(var n=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],o=0;o<64;o++){var i=h((n[o]*e+50)/100);i<1?i=1:255<i&&(i=255),S[p[o]]=i}for(var c=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],f=0,s=0;s<8;s++)for(var u=0;u<8;u++)C[f]=1/(D[p[f]]*c[s]*c[u]*8),P[f]=1/(S[p[f]]*c[s]*c[u]*8),f++})(e<50?Math.floor(5e3/e):Math.floor(200-2*e)),t=e,console.log("Quality set to: "+e+"%")}}this.encode=function(e,t,r){var a=(new Date).getTime();t&&te(t),_=new Array,q=0,H=7,$(65496),$(65504),$(16),Z(74),Z(70),Z(73),Z(70),Z(0),Z(1),Z(1),Z(0),$(1),$(1),Z(0),Z(0),function(){$(65499),$(132),Z(0);for(var e=0;e<64;e++)Z(D[e]);Z(1);for(var t=0;t<64;t++)Z(S[t])}(),function(e,t){$(65472),$(17),Z(8),$(t),$(e),Z(3),Z(1),Z(17),Z(0),Z(2),Z(17),Z(1),Z(3),Z(17),Z(1)}(e.width,e.height),function(){$(65476),$(418),Z(0);for(var e=0;e<16;e++)Z(N[e+1]);for(var t=0;t<=11;t++)Z(z[t]);Z(16);for(var r=0;r<16;r++)Z(G[r+1]);for(var a=0;a<=161;a++)Z(J[a]);Z(1);for(var n=0;n<16;n++)Z(Q[n+1]);for(var o=0;o<=11;o++)Z(F[o]);Z(17);for(var i=0;i<16;i++)Z(K[i+1]);for(var c=0;c<=161;c++)Z(V[c])}(),$(65498),$(12),Z(3),Z(1),Z(0),Z(2),Z(17),Z(3),Z(17),Z(0),Z(63),Z(0);var n=0,o=0,i=0;q=0,H=7,this.encode.displayName="_encode_";for(var c,f,s,u,h,l,d,v,g,m=e.data,w=e.width,y=e.height,b=4*w,p=0;p<y;){for(c=0;c<b;){for(l=h=b*p+c,d=-1,g=v=0;g<64;g++)l=h+(v=g>>3)*b+(d=4*(7&g)),y<=p+v&&(l-=b*(p+1+v-y)),b<=c+d&&(l-=c+d-b+4),f=m[l++],s=m[l++],u=m[l++],O[g]=(B[f]+B[s+256>>0]+B[u+512>>0]>>16)-128,W[g]=(B[f+768>>0]+B[s+1024>>0]+B[u+1280>>0]>>16)-128,T[g]=(B[f+1280>>0]+B[s+1536>>0]+B[u+1792>>0]>>16)-128;n=ee(O,C,n,x,E),o=ee(W,P,o,M,k),i=ee(T,P,i,M,k),c+=32}p+=8}if(0<=H){var I=[];I[1]=H+1,I[0]=(1<<H+1)-1,X(I)}if($(65497),r){for(var L=_.length,A=new Uint8Array(L),U=0;U<L;U++)A[U]=_[U].charCodeAt();_=[];var R=(new Date).getTime()-a;return console.log("Encoding time: "+R+"ms"),A}var j="data:image/jpeg;base64,"+btoa(_.join(""));_=[];R=(new Date).getTime()-a;return console.log("Encoding time: "+R+"ms"),j},function(){var e=(new Date).getTime();r=r||50,function(){for(var e=String.fromCharCode,t=0;t<256;t++)a[t]=e(t)}(),x=n(N,z),M=n(Q,F),E=n(G,J),k=n(K,V),function(){for(var e=1,t=2,r=1;r<=15;r++){for(var a=e;a<t;a++)y[32767+a]=r,w[32767+a]=[],w[32767+a][1]=r,w[32767+a][0]=a;for(var n=-(t-1);n<=-e;n++)y[32767+n]=r,w[32767+n]=[],w[32767+n][1]=r,w[32767+n][0]=t-1+n;e<<=1,t<<=1}}(),function(){for(var e=0;e<256;e++)B[e]=19595*e,B[e+256>>0]=38470*e,B[e+512>>0]=7471*e+32768,B[e+768>>0]=-11059*e,B[e+1024>>0]=-21709*e,B[e+1280>>0]=32768*e+8421375,B[e+1536>>0]=-27439*e,B[e+1792>>0]=-5329*e}(),te(r);var t=(new Date).getTime()-e;console.log("Initialization "+t+"ms")}()}_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){function v(e,t,r,a){var n=e.naturalWidth,o=e.naturalHeight;if(n+o){var i=r.width,c=r.height,f=t.getContext("2d");f.save(),function(e,t,r,a,n){switch(n){case 5:case 6:case 7:case 8:e.width=a,e.height=r;break;default:e.width=r,e.height=a}switch(n){case 2:t.translate(r,0),t.scale(-1,1);break;case 3:t.translate(r,a),t.rotate(Math.PI);break;case 4:t.translate(0,a),t.scale(1,-1);break;case 5:t.rotate(.5*Math.PI),t.scale(1,-1);break;case 6:t.rotate(.5*Math.PI),t.translate(0,-a);break;case 7:t.rotate(.5*Math.PI),t.translate(r,-a),t.scale(-1,1);break;case 8:t.rotate(-.5*Math.PI),t.translate(-r,0)}}(t,f,i,c,r.orientation),function(e){var t=e.naturalWidth;if(1048576<t*e.naturalHeight){var r=document.createElement("canvas");r.width=r.height=1;var a=r.getContext("2d");return a.drawImage(e,1-t,0),0===a.getImageData(0,0,1,1).data[3]}return!1}(e)&&(n/=2,o/=2);var s=1024,u=document.createElement("canvas");u.width=u.height=s;for(var h=u.getContext("2d"),l=a?function(e,t,r){var a=document.createElement("canvas");a.width=1,a.height=r;var n=a.getContext("2d");n.drawImage(e,0,0);for(var o=n.getImageData(0,0,1,r).data,i=0,c=r,f=r;i<f;){0===o[4*(f-1)+3]?c=f:i=f,f=c+i>>1}var s=f/r;return 0==s?1:s}(e,0,o):1,d=Math.ceil(s*i/n),v=Math.ceil(s*c/o/l),g=0,m=0;g<o;){for(var w=0,y=0;w<n;)h.clearRect(0,0,s,s),h.drawImage(e,-w,-g),f.drawImage(u,0,0,s,s,y,m,d,v),w+=s,y+=d;g+=s,m+=v}f.restore(),u=h=null}}var g=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;function e(e){if(window.Blob&&e instanceof Blob){if(!g)throw Error("No createObjectURL function found to create blob url");var t=new Image;t.src=g.createObjectURL(e),this.blob=e,e=t}if(!e.naturalWidth&&!e.naturalHeight){var a=this;e.onload=e.onerror=function(){var e=a.imageLoadListeners;if(e){a.imageLoadListeners=null;for(var t=0,r=e.length;t<r;t++)e[t]()}},this.imageLoadListeners=[]}this.srcImage=e}e.prototype.render=function(e,t,r){if(this.imageLoadListeners){var a=this;this.imageLoadListeners.push(function(){a.render(e,t,r)})}else{t=t||{};var n=this.srcImage.naturalWidth,o=this.srcImage.naturalHeight,i=t.width,c=t.height,f=t.maxWidth,s=t.maxHeight,u=!this.blob||"image/jpeg"===this.blob.type;i&&!c?c=o*i/n<<0:c&&!i?i=n*c/o<<0:(i=n,c=o),f&&f<i&&(c=o*(i=f)/n<<0),s&&s<c&&(i=n*(c=s)/o<<0);var h={width:i,height:c};for(var l in t)h[l]=t[l];var d=e.tagName.toLowerCase();"img"===d?e.src=function(e,t,r){var a=document.createElement("canvas");return v(e,a,t,r),a.toDataURL("image/jpeg",t.quality||.8)}(this.srcImage,h,u):"canvas"===d&&v(this.srcImage,e,h,u),"function"==typeof this.onrender&&this.onrender(e),r&&r(),this.blob&&(this.blob=null,g.revokeObjectURL(this.srcImage.src))}},"function"==typeof define&&define.amd?define([],function(){return e}):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=e:window.MegaPixImage=e}();